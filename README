$Header$

THIS CURRENTLY IS PUBLIC DOMAIN AND CAN BE DISTRIBUTED UNDER ANY
LICENSE.  However as it ekhtml is linked in statically, binaries must
be compliant to the EKTHML license.

Origin: http://www.scylla-charybdis.com/tool.php?tool=tinohtmlparse

This is currently based on ekhtml, a deadly inperfect HTML parser (for
example it does not parse Comments correctly, like in the following:
<!DTD -- comment 1 -- more DTD -- comment 2 -- again DTD />).  Perhaps
sometimes I come around and write a working version (which then shall
be able to sanitize HTML as well), but for now, we keep it as it is.

So first fetch ekhtml from CVS at sourceforge.net:
	cvs -d :pserver:anonymous@cvs.sourceforge.net:/cvsroot/ekhtml login
		(empty password)
	cvs -z3 -d :pserver:anonymous@cvs.sourceforge.net:/cvsroot/ekhtml co ekhtml

Compile it:
	cd ekhtml; ./autogen.sh; make

Create softlink to the source of ekhtml if you compiled it in another directory:
	ln -s ../somewhere/ekhtml ekhtml

Then type
	make

You can ignore the error that tinolib is missing as tinolib is not
required for this.  If you really want it, grab the distribution of
tinolib and let the softlink point there like this:
		ln -s ../somewhere/tinolib-*/old tinolib
Note that tinolib restricts distributions which bundle it to GPL!


After make you will get a simple program which converts any HTML file
into lines with the following parameters:

TYPE TAG PARAM Q TEXT

where TYPE is a type string (guaranteed to not contain a SPC), TAG
(never contains a SPC or is empty) is a TAG name, PARAM is a parameter
name (never contains a SPA or is empty), Q is a Quote type of the text
(never contains SPC or is empty), and a possibly multiline TEXT.
Continuation lines start with a + on the next line.  Usually the
"TYPE" is repeated as noted with the TYPE.  The last LF is always
added to text, so if TEXT ends on LF then you see LF TAB LF

In case Q is not processed it is given as -.  Q can be B which means
"boolean attribute with TEXT missing".  Q can be N which means, text
was not quoted (same as -).  Q can be ' or " in case this type of
quotes were removed from text.  There is a form which shall not show
up, which shows the Quote as two HEX digits HH.


So you can do

./tinohtmlparse < htmlfile |
grep -v ^+ |
./tinohtmlabsurl.sh "BASEURL" |
while read -r type tag name q text
do
	...
done


Output documentation:

open TAG
close TAG
	Open and closing TAG tags encountered.  TEXT is empty.

attr TAG NAME Q TEXT
	A named attribute, immediately follows "open".
	TAG is the TAG it belongs to, added for more easy parsing.
	NAME does not contain any non-whitespace characters.
	The Quotes are removed from TEXT and the TEXT is continued on
	the next line in case it contains an LF, which usually means,
	the attribute is faulty and you can happily ignore the
	continued text. Note that "attr HREF " apparently is an error.

text # LF - TEXT
comment # LF - TEXT
	# is the line count.
	LF is either 0 (TEXT does not contain a LF) or 1 (TEXT does contain an LF).
	Multiple lines are repetead this way, so there are no continuation lines.
	In case of the comment form, this is the commented out text.

The output was created for maximum parsing ease from the shell.  In
case of "continuation lines" (lines starting with TAB) this usually
means, that something with the TEXT is wrong, in nearly all cases you
can happily ignore it.

-Tino
webmaster@scylla-charybdis.com
$Log$
Revision 1.1  2005-02-05 23:07:28  tino
first commit, tinohtmlparse.c is missing "text" aggregation

